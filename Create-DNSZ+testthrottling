# Login to Azure
Connect-AzAccount
Get-Azsubscription -SubscriptionName [InsertSubscriptionName] | Select-AzSubscription

# Generate a unique alphanumeric resource group name
$resourceGroupUid = -join ((65..90) + (97..122) | Get-Random -Count 8 | % {[char]$_})
$resourceGroupName = "RG$resourceGroupUid"

# Generate a DNS Zone name that fits common domain expectations, ensuring it's not terribly long
$dnsZoneUid = -join ((65..90) + (97..122) | Get-Random -Count 8 | % {[char]$_})
$dnsZoneName = "dns$dnsZoneUid.com"

# Set location to centralus
$location = "centralus"

# Create the resource group
$rg = New-AzResourceGroup -Name $resourceGroupName -Location $location
Write-Output "Resource Group '$resourceGroupName' created in '$location'."

# Create the DNS zone
$dnsZone = New-AzDnsZone -Name $dnsZoneName -ResourceGroupName $resourceGroupName -ZoneType Public
Write-Output "DNS Zone '$dnsZoneName' created in Resource Group '$resourceGroupName'."

# Function to repeatedly query DNS zone information
function Get-DNSZoneRepeatedly {
    while ($true) {
        try {
            # Retrieve DNS zone information
            Get-AzDnsZone -Name $dnsZoneName -ResourceGroupName $resourceGroupName

            Write-Output "Request successful. Continuing..."
        }
        catch {
            Write-Output "Error encountered: $_"
            break
        }

        Start-Sleep -Seconds 1
    }
}

# Call the function
Get-DNSZoneRepeatedly
